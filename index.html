<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏ú‡∏±‡∏á‡πÇ‡∏ï‡πä‡∏∞‡∏á‡∏≤‡∏ô Goodbye</title>

<style>
  body {
    font-family: sans-serif;
    text-align: center;
  }

  .stage {
  width: 60%;
  max-width: 600px;
  height: 70px;

  margin: 20px auto 40px auto;

  background: linear-gradient(135deg, #2c2c2c, #555);
  color: white;

  font-size: 20px;
  font-weight: bold;
  letter-spacing: 1px;

  display: flex;
  align-items: center;
  justify-content: center;

  border-radius: 14px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.35);
  }

  .row {
    margin-bottom: 25px;
  }

  .row-title {
    font-weight: bold;
    margin-bottom: 8px;
  }

  .hint {
    font-size: 12px;
    color: #666;
    margin-bottom: 8px;
  }

  .tables {
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
  }

  button {
    width: 70px;
    height: 45px;
    cursor: pointer;
  }

  .booked {
    background-color: red;
    color: white;
    cursor: not-allowed;
  }
</style>
</head>
<body>

<h2>‡∏ú‡∏±‡∏á‡πÇ‡∏ï‡πä‡∏∞‡∏à‡∏µ‡∏ô‡∏á‡∏≤‡∏ô Goodbye</h2>

‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á:
<input type="text" id="name"><br><br>

<!-- ‡πÄ‡∏ß‡∏ó‡∏µ -->
<div class="stage">
  üé§ ‡πÄ‡∏ß‡∏ó‡∏µ (Stage)
</div>

<div id="layout"></div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw3hbLYmjgHkKSB5o9u5r7U4kyn3LUbQzz1Oqu_Am4-YQUVVq5n0BYEZKqwIJ1gD8dlPg/exec";

const layout = {
  A: ["A1","A2","A3","A4","A5"],
  B: ["B1","B2","B3","B4","B5"],
  C: ["C1","C2","C3","C4","C5"],
  D: ["D1","D2"]
};

let bookedTables = [];

function loadBookedTables() {
  fetch(SCRIPT_URL)
    .then(res => res.json())
    .then(data => {
      bookedTables = data;
      renderLayout();
    });
}

function renderLayout() {
  const container = document.getElementById("layout");
  container.innerHTML = "";

  for (const row in layout) {
    const rowDiv = document.createElement("div");
    rowDiv.className = "row";

    const title = document.createElement("div");
    title.className = "row-title";
    title.textContent = `‡πÅ‡∏ñ‡∏ß ${row}`;
    rowDiv.appendChild(title);

    // ‡πÉ‡∏ö‡πâ‡∏£‡∏∞‡∏¢‡∏∞‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡∏ó‡∏µ
    //const hint = document.createElement("div");
    //hint.className = "hint";
    //hint.textContent =
      //row === "A" ? "‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏ß‡∏ó‡∏µ" :
      //row === "D" ? "‡πÑ‡∏Å‡∏•‡πÄ‡∏ß‡∏ó‡∏µ" :
      //"‡∏£‡∏∞‡∏¢‡∏∞‡∏Å‡∏•‡∏≤‡∏á";
    //rowDiv.appendChild(hint);

    const tablesDiv = document.createElement("div");
    tablesDiv.className = "tables";

    layout[row].forEach(table => {
      const btn = document.createElement("button");
      btn.textContent = table;

      if (bookedTables.includes(table)) {
        btn.classList.add("booked");
        btn.disabled = true;
      } else {
        btn.onclick = () => bookTable(table, btn);
      }

      tablesDiv.appendChild(btn);
    });

    rowDiv.appendChild(tablesDiv);
    container.appendChild(rowDiv);
  }
}

function bookTable(table, btn) {
  const name = document.getElementById("name").value.trim();
  if (!name) {
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á");
    return;
  }

  fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({ name, table })
  })
  .then(res => res.text())
  .then(result => {
    if (result === "SUCCESS") {
      alert("‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à üéâ");
      btn.classList.add("booked");
      btn.disabled = true;
    } else if (result === "TABLE_BOOKED") {
      alert("‡πÇ‡∏ï‡πä‡∏∞‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß");
      loadBookedTables();
    } else if (result === "ALREADY_BOOKED") {
      alert("1 ‡∏Ñ‡∏ô‡∏à‡∏≠‡∏á‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà 1 ‡πÇ‡∏ï‡πä‡∏∞");
    }
  });
}

loadBookedTables();
</script>

</body>
</html>
